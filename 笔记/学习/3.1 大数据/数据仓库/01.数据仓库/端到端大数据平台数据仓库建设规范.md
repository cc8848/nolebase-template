- [端到端大数据平台数据仓库建设规范_java编程艺术的博客-CSDN博客_大数据平台规范](https://blog.csdn.net/penriver/article/details/118786967)

# 1 数据分层规范

[数据仓库](https://so.csdn.net/so/search?q=数据仓库&spm=1001.2101.3001.7020)的目的是构建面向分析的集成化数据环境，为企业提供决策支持（Decision Support），特点如下：

- 连接全域数据
- 实现数字化闭环
- 体现业务特征
- 自动化建模
- 高效数据运维
- 助力业务智能

**通过数据仓库，实现统一数据模型(即阿里的OneData理论）、统一采集、统一技术架构。**
![在这里插入图片描述](https://img-blog.csdnimg.cn/2021071610521858.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlbnJpdmVy,size_16,color_FFFFFF,t_70)

## 1.1 接口层

接口层面向外围数据源，负责数据源的管理及统一采集工作，管理外部数据的来源、[数据结构](https://so.csdn.net/so/search?q=数据结构&spm=1001.2101.3001.7020)、接口方式、格式要求、质量要求等信息。
数据模型与源系统基本保持一致。接口层数据按实时或准实时、按天、按月更新。

### 1.1.1 设计目标

- **完整性**：保证源系统输入模型的完整性、数据字典清晰明确；
- **及时性**：数据更新的频度与源系统接口数据更新频度基本一致，保证输入信息的及时性；
- **一致性**：接口数据一般不做清洗和转换，以保证和源系统信息的一致性，做到信息可追溯、过程可查。

### 1.1.2 设计要点

- **接口同步协议的约定**：含接口采集时间、频度、访问方式、抽取方式、触发条件、验证方法、重处理机制；
- **接口数据字典的约定**：明确接口数据内容，包括数据结构、数据存储方式、编码解释等；
- **数据模型结构和源系统的模型结构基本保持一致**；数据不做清洗、转换；可以增加辅助信息， 例如区分数据域、主题、地域、频度等；
- **统一命名规范**。

## 1.2 整合层

整合层在接口层的基础上，对接口层的数据进行数据**清洗、转换、补全**，整合层中的数据原则上是统一编码格式数据，可作为企业数据标准指导外围系统逐步统一数据格式。整合层的数据含与接口层同步的最新数据，及按天或月等与业务需求相关的快照数据。

### 1.2.1 设计目标

整合层设计目标如下：

- **一致性**：整合层模型对多个数据源进行统一清洗、转换、补全，保障数据的可用性；
- **及时性**：数据更新的频度和源系统接口模型的数据更新频度基本一致，保证输入信息的及时性；
- **完整性**：整合层数据是企业数据存储的核心，应确保数据的厚度和广度。

### 1.2.2 设计要点

- 数据清洗：识别和清洗无效、无用、异常信息，对缺失值、逻辑性错误进行数据清洗。确保数据的规范和有效；
- 数据转换：统一主数据编码，将相同含义不同编码的信息进行统一，根据设定的转换规则将源系统数据转换为统一的数据格式；
- 数据补全：根据业务基础数据，补全其它信息，如根据用户标识，补全用户的名称、手机号码、身份证号码等信息
- 数据格式规范：根据数据特点和应用要求，建立统一的数据格式。例如日期数据，“2021-03-01 12:00:00”；

## 1.3 中间层

中间层位于整合层和汇总层之间，整合各孤立的业务数据模型，按用户域、设备域、内容域、业务域建立一套面向主题的企业级数据模型。形成以业务实体为核心，基础属性、扩展属性为主体信息的数据模型，它以应用为目的提炼整合层信息，采用碎片化方式处理和存储，支持快速敏捷的数据处理、支持应用数据的快捷组装，满足应用需求多样化、及时性的要求，最大程度降低模型间耦合度。

**中间层主要由三类表构成，基础宽表、属性表和维表：**

- 基础宽表：根据应用主题将稳定的、事实的、共性的业务实体属性进行整合或轻粒度汇总，完成简单维度转换，保留原始编码，保留复杂业务口径的最细计算因子，不含业务口径的标签及维度；
- 属性表：因业务的不确定性，为确保基础宽表的稳定性，和应用模型的快速扩展性，将部分业务规则不稳定、易变化的属性信息整合形成属性表；
- 维度表：维表是对模型属性、维度的描述性信息集合，可具备多层、树形等结构形式。维表信息模式属于快照类、静态信息。不含标签类信息。

### 1.3.1 设计目标

- 低耦合：合理定义基础属性、扩展属性，避免属性定义重复、冗余出现；
- 稳定性：保持基础宽表模型的稳定性，通过属性表解决扩展属性变化频繁的问题；
- 高效性：模型解耦设计兼顾应用灵活组装和高效数据更新。

### 1.3.2 设计要点

采用星型建模，形成业务主体+基础属性或扩展属性基本结构。

**模型的基础处理功能设计：**

- 数据整合：明确业务主体，整合相关基础属性形成复杂业务维度及标签需要的基础因子；
- 数据映射：根据应用共性要求需形成不同层次、不同角度的基础维度信息，并建立源编码和维度值一对一或者多对一的映射关系；
- 数据属性标识：根据业务主体的规则完成属性标识计算，以及提供复杂口径的计算因子，如战略分群、上网偏好特征等；
- 数据汇总；按照一定的口径规则汇总业务实体的基础特征数据。

**模型的内容设计**：

按照加工方式和数据特点将属性信息一般分为四大类：实例对象信息、基础属性维度、统计维度信息、统计指标信息：

- 实例对象信息：以源数据为主，不作任何加工处理的实例化信息
- 基础属性维度：以源数据为主，不作任何加工处理的属性类信息，如 用户性别、地市等。保留源系统编码是非常有必要的，此类数据可以没有对应的维表但必须有对应的编码解释；
- 统计维度信息：通过将基础属性进行转换或归集得到的、有标准编码规范的、有层次的维度信息，维度字段保留最细粒度，如用户等级、用户所在区域；
- 统计指标信息：体现业务主体某种业务特征规模的统计值，通过一定规则汇总形成，单位保留原始单位，只做单位统一、不做单位转换，以免降低指标精度，如投诉次数、PV、UV等。

## 1.4 汇总层

汇总层面向应用，为支撑跨域企业级的数据分析、数据挖掘、即席查询等而形成的多级汇总数据层。包括以用户、设备等实例为粒度的应用宽表，以指标为粒度的指标集市，以应用标签为粒度的标签集市。其中，应用宽表与基础宽表的区别在于，应用宽表完成跨域数据整合，可来源于基础宽表、属性表、指标、标签信息。基础宽表完成业务主体相关的稳定的、事实的、共性的信息整合。

- 指标集：根据指标业务规则定义生成的指标实例数据；
- 标签集：根据业务规则定义生成的标签实例数据；
- 应用宽表：从客户和管理的角度构建应用宽表，如宽带产品宽表，含宽带产品基础信息、属性信息、标签信息、资源信息、成本信息等。

### 1.4.1 设计目标

**指标集**

- 提供以指标分析为主的数据应用支撑，防止因业务理解差异造成的数据质量问题；
- 提高指标复用度，达到一点修改多点变化的目的；
- 建立完整的企业级指标仓库，满足共性需求；
- 配合指标维度提升支撑灵活性。

**标签集**
用最简单的数据表现形式体现客户的基础特征、业务特征，提升使用的灵活度；原则上标签通过“是否”的方式进行实现。

**应用宽表的设计目标：**

- 继承性原则：模型中，对于业务中的核心实体和相关概念，在不影响理解的前提下，尽量不提出新的概念；
- 稳定性原则：为保证模型的稳定性，实体与规则分离，突出核心实体的描述，提出规则点，对规则本身不做详尽描述；
- 前瞻性原则：为保证模型的前瞻性，模型适当超前，能够适用业务的发展变化。

### 1.4.2 设计要点

**指标集：**

- 数据和元数据分离，数据模型中只存在指标编码和指标值；通过指标库获取指标元数据；
- 维度信息一般采用层次结构中最细层次的维度值；避免相同维度不同层级不同字段的设计；
- 指标字段单位保留原始单位，只做单位统一、不做单位转换，以免降低指标精度；
- 模型基本结构保持统一，由指标编码、基础维度（如账期和地域）、支持的业务维度、指标值四类信息构成，针对不同指标，除支持维度数量不同外，其他字段信息没有差别。

**标签集：**

- 采用数据和元数据分离的设计思路，数据模型中只保留业务实体实例编码、标签编码和标签值（只存在是否两种值）；通过标签库获取标签规则；
- 模型基本结构保持统一，由业务实体实例编码、基础维度（如账期和地域）、标签编码和标签值（只存在是否两种值）构成；
- 针对复杂的标签，保留生成过程中引用的基础标签信息。

**应用宽表设计要点：**

- 为保障模型稳定性、完整性和前瞻性的目标，以客户和管理两种视角整合相关信息，以应用主题为主键，聚合企业级数据基础信息、属性信息、标签信息、指标信息，形成主题宽表，允许信息冗余；
- 采用自顶向下的建模方法。模型内分级设计；
- 宽表信息唯一来源于中间层和标签集、指标集，不允许宽表相互间存在血缘关系；
- 维度信息一般采用最细层次的维度值；避免相同维度不同层级不同字段的设计。

## 1.5 应用层

应用层是提供给应用功能、外系统直接访问的数据层。因报表展现效率高、个性化展现方式和数据提供方式不一样等，要求单独建立数据层为各类应用提供数据支撑，方式可以通过表、视图、文件、消息等。

### 1.5.1 设计目标

应用层整体设计目标为：提高访问效率、提升访问安全、减少应用过程对基础资源的影响、满足个性化访问要求。数据可来源于从整合层到汇总层的所有数据模型。

- 报表应用：支撑多维的报表访问格式、支撑横纵表头访问；数据和元数据分开访问，即数据的描述信息单独提供；支撑跨时段数据提取；
- 查询应用：支持关键字快速检索；查询属性灵活扩展；
- 挖掘应用：独立建模，以前瞻性为主要原则，模型适当超前，聚合业务主体相关属性、适应业务的发展变化；
- 多维自助应用：支撑多维数据快速检索、快速汇聚，提供多层级粒度的汇总数据。

### 1.5.2 设计要点

- 采用维度建模方式，形成多维 数据模型；
- 多层级维度，一般要求在应用层形成多层级粒度的汇总数据；
- 按照应用要求设计字段格式、转换数据单位；
- 数据来源于接口层、整合层、中间层和汇总层，不同应用可以共用应用层数据。

# 2 数据存储周期策略

数据存储周期根据数据类型、数据粒度等几个纬度进行区分，再根据接口层、整合层、中间层、汇总层及应用层分别采取不同的存储时间。
数据存储周期策略表

| **数据类型**             | **数据粒度** | **存储周期** |              |              |                                                              |                      |
| ------------------------ | ------------ | ------------ | ------------ | ------------ | ------------------------------------------------------------ | -------------------- |
| 接口层                   | 整合层       | 中间层       | 汇总层       | 应用层       |                                                              |                      |
| 设备产生的数据或系统日志 | 日           | 7天          | 1个月        | （12+1）个月 | 指标、标签及常态化的应用宽表长期保持；阶段性应用宽表依赖应用生命周期 | 依赖于应用的生命周期 |
| 月                       | 3个月        | 3个月        | （12+1）个月 |              |                                                              |                      |
| 实时                     | 7天(kafka)   | 1个月        | （12+1）个月 |              |                                                              |                      |
| 详单                     | 日           | 7天          | 1个月        | （12+1）个月 |                                                              |                      |
| 月                       | 1个月        | 2个月        | （12+1）个月 |              |                                                              |                      |
| 实时                     | 7天(kafka)   | 1个月        | （12+1）个月 |              |                                                              |                      |

# 3 数据命名规范

## 3.1 频度标识规范

| 频度 | 标识 |
| ---- | ---- |
| 实时 | RL   |
| 分钟 | MI   |
| 小时 | H    |
| 日   | D    |
| 周   | W    |
| 月   | M    |
| 年   | Y    |

## 3.2 数据表命名规范

| 所属分层 | 命名格式                                                     | 示例                                                |
| -------- | ------------------------------------------------------------ | --------------------------------------------------- |
| 接口层   | SRC_表名_频度                                                | SRC_XXX_D 从SQM按天采集的xxx的基本信息表            |
| 整合层   | TB_表名_频度                                                 | TB_XXX_D 和接口层只有表头区别                       |
| 中间层   | MI_主题域_表名_频度                                          | MI_XXX_D xxx基础宽表                                |
| 汇总层   | SUM_业务分类_表名_频度( IND-指标集，FLG-标签集，WT-应用宽表) | SUM_IND_XXX_D 汇总的xxx指标表                       |
| 应用层   | FRT_报表分类_表名_频度                                       | RT_XX_XXX_D 地市XXX展示指标表                       |
| 维表     | DIM_表名                                                     | DIM_CITY_INFO 地市编码维表                          |
| 临时表   | TMP_表名_序号                                                | TMP_XXX_D_1 临时的XXX表1                            |
| 备份表   | BK_目标版_YYYYMMDD                                           | BAK_DIM_XXX_INFO_2019120120191201备份的地市编码维表 |

## 3.3 字段命名规范

| 字段类型          | 特征                                         | 物理命名格式                           | 示例                      |
| ----------------- | -------------------------------------------- | -------------------------------------- | ------------------------- |
| 实例信息/基础属性 | 以源数据为主                                 | 以源数据字段命名为主，结合特定字段要求 | USER_ID 用户实例标识      |
| 统计维度          | 根据应用需要，建立的有标准编码，有层次的信息 | D_维度名简写_ID                        | D_TERM_ID 产品类型        |
| 统计标识          | 只有正反两面的维度标识                       | IS_标识名简写                          | IS_CREATE_USER 新用户标识 |
| 统计指标          | 某种业务特征规模的统计值                     | 指标名_NUM                             | CREATE_USER_NUM 新用户数  |
| 时间              |                                              | 业务名称_DT                            | CREATE_DT 创建时间        |
| 实例标识          | 某类型规格的实例信息编码                     | 业务名称_ID                            | SERV_ID 实例标识          |

其他要求：
1） 英文单词和0-9自然数描述，业务单词禁止缩写
2） 单词和数字之间 _ 分割
3） 全部大写，禁止小写
4） 字段必须填写注释信息
5） 禁止使用关键字，DATETIME, PASSWORD等
6） 简洁，一般不超过三个单词
7） 多处一样含义的字段使用同一个字段名称

# 4. 数据仓库架构

各个公司根据其业务特点，采用的架构及技术栈不同。下图是基于目前的热门技术栈，实现数据仓库的架构

## 4.1体系架构图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210716104422178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlbnJpdmVy,size_16,color_FFFFFF,t_70)

## 4.2 [技术架构](https://so.csdn.net/so/search?q=技术架构&spm=1001.2101.3001.7020)图

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210716104524132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BlbnJpdmVy,size_16,color_FFFFFF,t_70)